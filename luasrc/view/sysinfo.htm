<%
local file_is_enabled = (luci.sys.call("grep -Fxq \"/etc/sysinfo\" \"/etc/profile\"") == 0)
local state = file_is_enabled and "1" or "0"

local status_text
local effect_description

if state == "1" then
    status_text  = "<font color=\"Green\"><strong>" .. translate("Already Enabled") .. "</strong></font>"
    effect_description = translate("Screenshot when Enabled: Detailed system info is displayed.")
else
    status_text  = "<font color=\"Red\"><strong>" .. translate("Already Disabled") .. "</strong></font>"
    effect_description = translate("Screenshot when Disabled: Only a basic welcome message is displayed.")
end
%>

<script type="text/javascript">//<![CDATA[
    
    function toggleSysInfo(action, btn_id) {
        var btn = document.getElementById(btn_id);
        var original_value = btn.value;
        var new_state = (action === 'enable' ? 1 : 0);
        
        btn.disabled = true;
        btn.value = '<%:Applying...%>';

        XHR.get('<%=luci.dispatcher.build_url("admin", "system", "advanced", "sysinfo")%>', { value: new_state }, function(x, data) {
            btn.disabled = false;
            
            if (data && data.code === 0) {
                location.reload(); 
            } else {
                btn.value = original_value; 
                alert('<%:Failed to change status: %> ' + (data ? data.error : x.statusText));
            }
        });
    }

//]]></script>

<div class="cbi-section-descr" style="padding: 10px; background-color: #f9f9f9; border: 1px solid #eee;">
    <strong><%:Effect Preview%>:</strong>
    <p style="margin-top: 5px;"><%=effect_description%></p>

    <div style="text-align: center; border: 1px dashed #ccc; padding: 15px; background-color: #fff; margin-top: 10px;">
        <% if state == "1" then %>
        
        <br>
        <em style="color: green;"><%:Terminal Output (Enabled)></em>
        <% else %>
        
        <br>
        <em style="color: red;"><%:Terminal Output (Disabled)></em>
        <% end %>
    </div>
</div>

<div class="cbi-value">
    <label class="cbi-value-title" style="margin-top: 0.45rem;"><%=translate("Terminal System Infomation")%></label>
    <div class="cbi-value-field">
        <div class="cbi-value-description">
            <span style="padding-right: 15px; display: inline-block;">
                <%=status_text%>
            </span>
            
            <% if state == "1" then %>
            <input class="btn cbi-button cbi-button-negative" 
                type="button" 
                id="sysinfo_disable_btn"
                onclick="toggleSysInfo('disable', 'sysinfo_disable_btn')"
                value="<%=translate("Click to disable")%>" 
                style="margin-right: 10px;" />
            <% else %>
            <input class="btn cbi-button cbi-button-positive" 
                type="button" 
                id="sysinfo_enable_btn"
                onclick="toggleSysInfo('enable', 'sysinfo_enable_btn')"
                value="<%=translate("Click to enable")%>" 
                style="margin-right: 10px;" />
            <% end %>
    
        </div>
    </div>
</div>
